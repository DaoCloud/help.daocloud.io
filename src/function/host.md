#自有主机

混合式容器主机（自有主机）管理服务是国内首个支持包括公有云、私有云、虚拟化平台和物理服务器，并且可跨云跨网进行混合式管理的容器服务平台，该项服务能够与DaoCloud云端持续集成、镜像构建、应用发布流程无缝对接，实现容器化应用在公有云、私有云的灵活交付。

## 功能描述

混合式容器主机管理服务是DaoCloud的一项独创技术，使用这项功能，DaoCloud用户可以通过一致的界面和流程，管理在公有云、私有云甚至是企业防火墙之后的各类物理和虚拟主机资源，把这些资源汇聚成跨云跨网的分布式容器主机资源池，实现容器化应用的高速部署和灵活调度。DaoCloud已经支持包括微软Azure、亚马逊AWS、阿里云、UCloud、青云等国内一线公有云厂商，并且正在帮助企业客户实施内网私有云容器集群的混合式管理，为企业客户打造能够支持微服务和轻应用的新一代混合式容器云平台。

## 主机要求
 - Docker已经安装
 - 可以连接网路（不需要公网IP）
 - 可以是虚拟机也可以是物理机器

## 支持系统

| 操作系统       | 版本      |安装支持| 完整服务支持| 注意事项| 安装方法| 卸载方法          | 操作                                |
| ------------- |:--------:|:----:|:----------:|:-----:|:------:|:---------------:|:-----------------------------------:|
| ubuntu        | 12.04    |      |  有        |       | 界面    | dpkg -r daominit | service daomonit start/stop/restart |
|               | 14.04    |      |  有        |       | 界面    | dpkg -r daominit | service daomonit start/stop/restart |
|               | 15.04    |      |  无        |开机重启Docker 需要设置需要操作 chkconfig docker on Docker     | 界面    | dpkg -r daominit | service daomonit start/stop/restart |
| centos        | 6        |      |  有        |       | 界面    | rpm -e daominit  | service daomonit start/stop/restart |
|               | 7        |      |  有        |chkconfig docker on| 界面    | rpm -e daominit  | service daomonit start/stop/restart |
| debian        | 7        |      |  无        |       | 界面    | dpkg -r daominit | service daomonit start/stop/restart |
| fedora        | 18       |      |  无        |chkconfig docker on| 界面    | rpm -e daominit  | service daomonit start/stop/restart |
|               | 20       |      |  无        |chkconfig docker on| 界面    | rpm -e daominit  | service daomonit start/stop/restart |

 - 注：完整服务支持 相对于 仅仅安装支持 是有更完善的服务。

## 运行原理&工作流程
1. 在您的主机上安装daomonit。
2. 在DashBoard上查看，监控，操作您的主机
3. 使用DaoCloud正常流程构建代码生成Image到云平台的镜像仓库
4. 部署时选择已经连接的主机，设置环境变量，启动参数等。
5. daomonit会帮助您从云平台上的镜像库中下载Image到您的主机上。
6. 完成部署，运行容器。

## 操作流程

### 选择功能
![](/img/host/1.png)

### 添加主机

![](/img/host/2.png)

 - 点击添加主机进入安装导航页面
 - 根据导航页面上的提示，按次序复制命令，并在我的主机上执行安装

![](/img/host/3.png)

 - 安装成功后，返回到DaoCloud控制台，能够看到接收主机信息

![](/img/host/4.png)

 - 返回主机列表能看到自己的主机状态

![主机列表](/img/host/5.png)

### 部署DaoCloud上构建的Image到自己的主机中

 - 在镜像仓库中选择目标Image执行部署业务中
 - 选择我的主机

![](/img/host/6.png)

 - 特别的，在基础设置中我们提供了更加丰富的选项： 与主机的端口映射，和磁盘挂载

![](/img/host/11.png)

 - 在高级选项中我们提供了启动命令的设置选项，以及是否在进程终止之后自动重启容器的选项。

 ![](/img/host/12.png)

 - 点击立即部署

![](/img/host/7.png)

 - daomonit会自动将为您部署云平台上的DockerImage到您自己的主机上

## 管理我的主机与主机内的容器

 - 进入我的主机显示您的主机列表，能够查看当前主机的一些信息。

![](/img/host/8.png)

 - 在上一个界面中点击容器列表可以查看在自己所有主机上的所有容器。

![](/img/host/9.png)

 - 在主机列表中选择主机可以查看主机状态，容器状态，信息全面参考价值很高，给运维带来极大的便利。

![](/img/host/10.png)

## 部署DaoCloud镜像到您的主机中
DaoCloud为您提供了非常丰富定制应用部署到您的主机中。

 - 在控制台中，选择镜像仓库-DaoCloud镜像可以进入到如下界面

![](/img/host/13.png)

 - 选择您需要的Image

 - 仔细阅读说明，这里会强调一些您可能需要的服务参数

 - 选择部署最新版本进入应用部署界面。

 - 在基础设置中根据需求修改端口以及磁盘挂载，这里的操作与主机部署自己的应用是一致的。

 - 在高级选项中可以修改启动命令，设置自动重启。点击立即部署完成整个业务。

## 常见问题

### 容器服务启动后，如何访问容器内的应用？

 - 不同于DaoCloud提供的云端容器管理集群，您需要在您的自有主机上映射容器端口和主机的端口，必要时开需要开启防火墙端口。

### 部署在自有主机上的容器应用，如何使用数据库服务？

 - 您可以在自有主机上以容器的方式部署MySQL等数据库服务，或使用您的IT环境中已有的数据库服务，通过环境变量的方式，让容器内的应用访问您的数据服务。

### 自有主机环境，跟DaoCloud提供的云端容器运行环境，有何区别？

 - DaoCloud提供的云端容器运行环境，是一套完备的容器化应用管理平台，提供了包括应用起停、服务集成、弹性扩展、性能监控、日志管理、域名绑定等应用生命周期服务，具备了PaaS平台的全部功能。
 - 自有主机是由用户进行管理维护的主机，DaoCloud通过先进的跨云跨网技术，将DaoCloud云端持续集成、镜像构建功能与用户自有资源无缝对接，实现混合式应用交付。应用部署到自有主机后，用户需要自行完成网络端口映射、负载均衡等操作。

### 如果把自有主机关机，DaoCloud会如何处理？

 - 自有主机关机后，DaoCloud会显示主机处在失联状态，您开机后，会自动重新建立连接。

### 在自有主机上安装的主机监控程序起什么作用？

 - 主机监控程序负责自有主机与DaoCloud云端管理平台的通信工作，并且通过调用自有主机上的Docker API来完成容器的管理工作。

### 在自有主机部署应用，或者进行容器管理时，响应速度较慢，是什么原因？

 - 响应速度取决于自有主机的网络带宽，如果网络速度较慢，可能会引起镜像下载超时，与DaoCloud云端服务链接中断等问题。请确保您的自有主机接入高速稳定的网络，或在DaoCloud操作界面选择重试、重新部署或刷新页面。
